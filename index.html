<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Pixel board</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="preamble" style="text-align:center;">
      Press <b>x</b> to reset the trace, <b>c</b> to cycle through colours.
      If you hold the mouse down and move, you won't leave a trace.
      <div id="colorsContainer"></div>
      <br><br>
    </div>
    <div id="container"></div>
  </body>

  <script>
    var colors = ['black', 'blue', 'teal', 'yellow', 'orange', 'pink'];
    var colorsHex = ['black', '#0074D9', '#39CCCC', '#FFDC00', '#FF851B', '#E91E63'];
    var activeColor = 0;

    window.onresize = redrawBoard;
    window.onkeyup = dealWithKeyboardMash;
    drawPreamble();
    redrawBoard();

    function dealWithKeyboardMash(e) {
      var key = e.keyCode ? e.keyCode : e.which;
      if (key == 88) {  // x
        resetTraces();
      } else if (key == 67) {  // c
        cycleColour();
      }
    }

    function redrawBoard() {
      var pixelSize = 16;
      var preambleSize = preamble.getBoundingClientRect()
      var topPadding = preambleSize.height + preambleSize.top;
      var width = Math.floor((window.innerWidth) / pixelSize);
      var height = Math.floor((window.innerHeight - topPadding) / pixelSize);

      // Draw a grid of pixels.
      container.innerHTML = '';
      for (var i = 0; i < height; i++) {
        for (var j = 0; j < width; j++) {
          var box = document.createElement('div');
          box.className = 'box black';
          container.appendChild(box);
        }
        // Eh why not. 
        container.appendChild(document.createElement('br'));
      }
    }

    // Lay out the "available colours" container.
    function drawPreamble() {
      for (var i = 0; i < colors.length; i++) {
        var box = document.createElement('div');
        box.style.backgroundColor = colorsHex[i];
        if (i == 0) {
          box.className = 'active';
        }
        colorsContainer.appendChild(box);
      }
    }

    // Trigger a repaint to reset the animations.
    function resetTraces() {
      container.style.display = 'none';
      container.offsetHeight;
      container.style.display = 'block';
    }

    function cycleColour() {
      var all = container.querySelectorAll('.box');
      var colorBoxes = colorsContainer.querySelectorAll('div');

      // Highight the next active colour.
      colorBoxes[activeColor].className = '';
      activeColor = (activeColor === colors.length - 1) ? 0 : activeColor + 1;
      colorBoxes[activeColor].className = 'active';

      // Apply it to all the pixels.
      for (var i = 0; i < all.length; i++) {
        all[i].className = 'box ' + colors[activeColor];
      }
    }

  </script>

</html>
